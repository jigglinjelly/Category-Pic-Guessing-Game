<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto-Detect Image Guessing Game</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1000px;
            width: 100%;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 25px;
            margin-top: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 10px;
        }
        
        .header h1 {
            color: white;
            font-size: 3rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .players-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }
        
        .player {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            width: 45%;
            transition: all 0.3s ease;
            position: relative;
            background: #f8f9fa;
        }
        
        .player.active {
            background: #e3f2fd;
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
            transform: scale(1.03);
        }
        
        .player h2 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .player-name {
            border: none;
            background: transparent;
            font-size: 1.5rem;
            text-align: center;
            width: auto;
            max-width: 120px;
            padding: 5px;
            border-radius: 4px;
            margin: 0 5px;
            border: 1px solid #ddd;
        }
        
        .player-name:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 0 2px #2196f3;
        }
        
        .score {
            font-size: 2rem;
            font-weight: bold;
            color: #2196f3;
        }
        
        .time-bank {
            margin-top: 10px;
            font-size: 1.2rem;
            color: #e74c3c;
        }
        
        .game-area {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .image-container {
            width: 100%;
            height: 500px;
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        #currentImage {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 8px;
        }
        
        .answer-display {
            font-size: 2rem;
            margin: 15px 0;
            padding: 15px;
            border-radius: 10px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .correct-answer {
            background: #e8f5e9;
            color: #2e7d32;
            font-weight: bold;
        }
        
        .pass-answer {
            background: #ffebee;
            color: #c62828;
            font-weight: bold;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        button {
            padding: 15px 30px;
            font-size: 1.2rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .key-shortcut {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #555;
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }
        
        #correctBtn {
            background: #4caf50;
            color: white;
        }
        
        #correctBtn:hover:not(:disabled) {
            background: #388e3c;
            transform: translateY(-3px);
        }
        
        #passBtn {
            background: #f44336;
            color: white;
        }
        
        #passBtn:hover:not(:disabled) {
            background: #d32f2f;
            transform: translateY(-3px);
        }
        
        #pauseBtn {
            background: #ff9800;
            color: white;
        }
        
        #pauseBtn:hover:not(:disabled) {
            background: #f57c00;
            transform: translateY(-3px);
        }
        
        #pauseBtn.paused {
            background: #2196f3;
        }
        
        #pauseBtn.paused:hover:not(:disabled) {
            background: #1976d2;
        }
        
        #startBtn {
            background: #2196f3;
            color: white;
            padding: 15px 40px;
            margin: 0 auto;
            display: block;
        }
        
        #startBtn:hover {
            background: #1976d2;
            transform: translateY(-3px);
        }
        
        #loadImagesBtn {
            background: #9c27b0;
            color: white;
            margin-top: 15px;
        }
        
        #loadImagesBtn:hover {
            background: #7b1fa2;
            transform: translateY(-3px);
        }
        
        .instructions {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .instructions h3 {
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .instructions ul {
            list-style-type: none;
            padding-left: 20px;
            margin-bottom: 15px;
        }
        
        .instructions li {
            margin-bottom: 8px;
            position: relative;
            padding-left: 25px;
        }
        
        .instructions li:before {
            content: "•";
            color: #2196f3;
            font-weight: bold;
            position: absolute;
            left: 0;
        }
        
        .game-over {
            text-align: center;
            padding: 20px;
            background: #fff8e1;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }
        
        .game-over h2 {
            color: #f57c00;
            margin-bottom: 15px;
        }
        
        .settings {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .settings h3 {
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .settings label {
            display: block;
            margin: 8px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .settings input {
            padding: 8px;
            width: 80px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .category-selection {
            background: #fff3e0;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .category-selection h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .categories {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .category {
            flex: 1;
            min-width: 200px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 2px solid #ff9800;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .category:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .category.selected {
            background: #ff9800;
            color: white;
        }
        
        .category h4 {
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .category.selected h4 {
            color: white;
        }
        
        .category p {
            font-size: 0.9rem;
            color: #666;
        }
        
        .category.selected p {
            color: #f0f0f0;
        }
        
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
            display: none;
        }
        
        .status.loading {
            background: #e3f2fd;
            color: #1976d2;
            display: block;
        }
        
        .status.success {
            background: #e8f5e9;
            color: #2e7d32;
            display: block;
        }
        
        .status.error {
            background: #ffebee;
            color: #c62828;
            display: block;
        }
        
        @media (max-width: 600px) {
            .players-container {
                flex-direction: column;
                align-items: center;
            }
            
            .player {
                width: 100%;
                margin-bottom: 15px;
            }
            
            .image-container {
                height: 350px;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            button {
                width: 80%;
            }
            
            .settings label {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .settings input {
                width: 100%;
                margin-top: 5px;
            }
            
            .player-name {
                max-width: 100px;
            }
            
            .header h1 {
                font-size: 2.2rem;
            }
            
            .categories {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Auto-Detect Image Guessing Game</h1>
        <p>Automatically loads images from the 'images' folder in this repository</p>
    </div>
    
    <div class="container">
        <div class="category-selection">
            <h3>Select Image Category</h3>
            <div class="categories" id="categoriesContainer">
                <div class="category-placeholder">Categories will load automatically...</div>
            </div>
            <p>Selected category: <span id="selectedCategory">None</span></p>
            <div id="statusMessage" class="status loading">Detecting image categories...</div>
        </div>
        
        <div class="settings">
            <h3>Game Settings</h3>
            <label>
                Initial Time (seconds):
                <input type="number" id="initialTime" value="60" min="10" max="300">
            </label>
            <label>
                Pass Penalty (seconds):
                <input type="number" id="passPenalty" value="5" min="0" max="30">
            </label>
        </div>
        
        <div class="players-container">
            <div class="player" id="player1">
                <h2>
                    <span>Player</span>
                    <input type="text" class="player-name" id="player1Name" value="Player 1" maxlength="12">
                </h2>
                <div class="score">0</div>
                <div class="time-bank">Time: 60.0s</div>
            </div>
            <div class="player" id="player2">
                <h2>
                    <span>Player</span>
                    <input type="text" class="player-name" id="player2Name" value="Player 2" maxlength="12">
                </h2>
                <div class="score">0</div>
                <div class="time-bank">Time: 60.0s</div>
            </div>
        </div>
        
        <div class="game-area">
            <div class="image-container">
                <img id="currentImage" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300' viewBox='0 0 400 300'%3E%3Crect width='400' height='300' fill='%23f8f9fa'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-size='24' fill='%23ccc'%3ELoading categories...%3C/text%3E%3C/svg%3E">
            </div>
            <div class="answer-display" id="answerDisplay"></div>
            
            <div class="controls">
                <button id="correctBtn" disabled>
                    <span class="key-shortcut">←</span>
                    Correct!
                </button>
                <button id="pauseBtn" disabled>
                    <span class="key-shortcut">P</span>
                    Pause
                </button>
                <button id="passBtn" disabled>
                    <span class="key-shortcut">→</span>
                    Pass
                </button>
            </div>
            
            <div class="keyboard-hint">
                Use keyboard shortcuts: ← for Correct, P for Pause, → for Pass
            </div>
            
            <button id="startBtn" disabled>Start Game</button>
        </div>
        
        <div class="game-over" id="gameOver">
            <h2>Game Over!</h2>
            <p id="winnerMessage"></p>
            <button id="restartBtn">Play Again</button>
        </div>
        
        <div class="instructions">
            <h3>Game Rules</h3>
            <ul>
                <li>Players take turns guessing what's shown in the picture</li>
                <li>The answer is the filename of the image (without extension)</li>
                <li>Click "Correct!" to get 1 point and show the correct answer (green)</li>
                <li>Click "Pass" to skip the image, show the answer (red) and deduct time</li>
                <li>Each player has an individual time bank - game ends when time runs out</li>
                <li>Time only decreases during guessing, not when answers are shown</li>
                <li>Images won't repeat during the same game</li>
                <li>Game ends when either time runs out or all images are used</li>
                <li>Press P or click Pause button to pause/resume the game</li>
            </ul>
            <h3>How to Set Up Your Repository</h3>
            <ol>
                <li>Create an 'images' folder in your repository</li>
                <li>Inside the 'images' folder, create subfolders for each category (e.g., "animals", "landmarks")</li>
                <li>Upload your images to the appropriate category folders</li>
                <li>The game will automatically detect all categories and images</li>
            </ol>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Game elements
            const currentImageElement = document.getElementById('currentImage');
            const answerDisplayElement = document.getElementById('answerDisplay');
            const correctBtn = document.getElementById('correctBtn');
            const passBtn = document.getElementById('passBtn');
            const pauseBtn = document.getElementById('pauseBtn');
            const startBtn = document.getElementById('startBtn');
            const restartBtn = document.getElementById('restartBtn');
            const gameOverElement = document.getElementById('gameOver');
            const winnerMessageElement = document.getElementById('winnerMessage');
            const player1Element = document.getElementById('player1');
            const player2Element = document.getElementById('player2');
            const player1ScoreElement = player1Element.querySelector('.score');
            const player2ScoreElement = player2Element.querySelector('.score');
            const player1TimeElement = player1Element.querySelector('.time-bank');
            const player2TimeElement = player2Element.querySelector('.time-bank');
            const player1NameElement = document.getElementById('player1Name');
            const player2NameElement = document.getElementById('player2Name');
            const initialTimeInput = document.getElementById('initialTime');
            const passPenaltyInput = document.getElementById('passPenalty');
            const categoriesContainer = document.getElementById('categoriesContainer');
            const selectedCategoryElement = document.getElementById('selectedCategory');
            const statusMessage = document.getElementById('statusMessage');
            
            // Game state
            let currentPlayer = 1;
            let player1Score = 0;
            let player2Score = 0;
            let player1Time = 60.0;
            let player2Time = 60.0;
            let timerInterval = null;
            let gameActive = false;
            let gamePaused = false;
            let answerTimeout = null;
            let lastTimerUpdate = 0;
            let usedImages = [];
            let availableImages = [];
            let selectedCategory = null;
            let categories = {};
            
            // Initialize the game
            function initGame() {
                // Load saved data from localStorage
                const savedPlayer1Name = localStorage.getItem('player1Name');
                const savedPlayer2Name = localStorage.getItem('player2Name');
                
                if (savedPlayer1Name) player1NameElement.value = savedPlayer1Name;
                if (savedPlayer2Name) player2NameElement.value = savedPlayer2Name;
                
                // Automatically load categories from the images folder
                loadCategoriesFromRepo();
            }
            
            // Load categories from the repository
            async function loadCategoriesFromRepo() {
                showStatus('Detecting image categories from repository...', 'loading');
                
                try {
                    // Get the current repository path
                    const repoPath = window.location.pathname.split('/').slice(0, 3).join('/');
                    const imagesBaseUrl = `https://api.github.com/repos${repoPath}/contents/images`;
                    
                    // Fetch the contents of the images folder
                    const response = await fetch(imagesBaseUrl);
                    
                    if (!response.ok) {
                        // If the images folder doesn't exist, try alternative approaches
                        await tryAlternativeApproaches();
                        return;
                    }
                    
                    const data = await response.json();
                    
                    // Filter out only directories
                    const categoryDirs = data.filter(item => item.type === 'dir');
                    
                    if (categoryDirs.length === 0) {
                        showStatus('No category folders found in images directory.', 'error');
                        return;
                    }
                    
                    // Get images for each category
                    categories = {};
                    let loadedCategories = 0;
                    
                    for (const dir of categoryDirs) {
                        try {
                            const categoryResponse = await fetch(dir.url);
                            if (!categoryResponse.ok) continue;
                            
                            const categoryData = await categoryResponse.json();
                            
                            // Filter image files (common extensions)
                            const imageFiles = categoryData.filter(item => {
                                const extension = item.name.split('.').pop().toLowerCase();
                                return ['jpg', 'jpeg', 'png', 'gif', 'webp', 'svg'].includes(extension);
                            });
                            
                            if (imageFiles.length > 0) {
                                // Get the raw content URL for each image
                                categories[dir.name] = imageFiles.map(file => {
                                    // Use direct raw.githubusercontent URL
                                    const rawUrl = file.download_url || 
                                        `https://raw.githubusercontent.com${repoPath}/main/images/${dir.name}/${file.name}`;
                                    return rawUrl;
                                });
                                loadedCategories++;
                            }
                        } catch (error) {
                            console.error(`Error loading category ${dir.name}:`, error);
                        }
                    }
                    
                    if (loadedCategories === 0) {
                        showStatus('No images found in category folders.', 'error');
                        return;
                    }
                    
                    displayCategories(categories);
                    showStatus(`Successfully loaded ${loadedCategories} categories with images!`, 'success');
                    
                } catch (error) {
                    console.error('Error loading from repository:', error);
                    showStatus('Error loading categories. Using fallback images.', 'error');
                    // Load fallback categories if automatic detection fails
                    loadFallbackCategories();
                }
            }
            
            // Try alternative approaches to find images
            async function tryAlternativeApproaches() {
                try {
                    // Try to get repository info from the current URL
                    const pathParts = window.location.pathname.split('/');
                    const username = pathParts[1];
                    const repo = pathParts[2];
                    
                    if (username && repo) {
                        // Try to access the images folder directly
                        const apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/images`;
                        const response = await fetch(apiUrl);
                        
                        if (response.ok) {
                            const data = await response.json();
                            const categoryDirs = data.filter(item => item.type === 'dir');
                            
                            if (categoryDirs.length > 0) {
                                categories = {};
                                let loadedCategories = 0;
                                
                                for (const dir of categoryDirs) {
                                    try {
                                        const categoryResponse = await fetch(dir.url);
                                        if (!categoryResponse.ok) continue;
                                        
                                        const categoryData = await categoryResponse.json();
                                        
                                        // Filter image files
                                        const imageFiles = categoryData.filter(item => {
                                            const extension = item.name.split('.').pop().toLowerCase();
                                            return ['jpg', 'jpeg', 'png', 'gif', 'webp', 'svg'].includes(extension);
                                        });
                                        
                                        if (imageFiles.length > 0) {
                                            categories[dir.name] = imageFiles.map(file => {
                                                return file.download_url || 
                                                    `https://raw.githubusercontent.com/${username}/${repo}/main/images/${dir.name}/${file.name}`;
                                            });
                                            loadedCategories++;
                                        }
                                    } catch (error) {
                                        console.error(`Error loading category ${dir.name}:`, error);
                                    }
                                }
                                
                                if (loadedCategories > 0) {
                                    displayCategories(categories);
                                    showStatus(`Successfully loaded ${loadedCategories} categories with images!`, 'success');
                                    return;
                                }
                            }
                        }
                    }
                    
                    // If all else fails, use fallback categories
                    showStatus('Could not detect images folder. Using fallback categories.', 'error');
                    loadFallbackCategories();
                    
                } catch (error) {
                    console.error('Error in alternative approach:', error);
                    showStatus('Error loading categories. Using fallback images.', 'error');
                    loadFallbackCategories();
                }
            }
            
            // Load fallback categories if automatic detection fails
            function loadFallbackCategories() {
                categories = {
                    animals: [
                        "https://placekitten.com/400/300",
                        "https://placekitten.com/401/300",
                        "https://placekitten.com/402/300",
                        "https://placekitten.com/403/300"
                    ],
                    landmarks: [
                        "https://picsum.photos/400/300?historical",
                        "https://picsum.photos/401/300?historical",
                        "https://picsum.photos/402/300?historical"
                    ]
                };
                
                // Generate appropriate answer names for fallback images
                const categorizedImages = {};
                for (const [category, urls] of Object.entries(categories)) {
                    categorizedImages[category] = urls.map((url, index) => {
                        return {
                            name: `${category} ${index + 1}`,
                            url: url
                        };
                    });
                }
                
                displayCategories(categorizedImages);
                showStatus('Using fallback images. Add your own images to the /images folder.', 'success');
            }
            
            // Display categories UI
            function displayCategories(cats) {
                categoriesContainer.innerHTML = '';
                
                if (Object.keys(cats).length === 0) {
                    categoriesContainer.innerHTML = '<div class="category-placeholder">No categories found</div>';
                    return;
                }
                
                for (const [categoryName, imageUrls] of Object.entries(cats)) {
                    const categoryElement = document.createElement('div');
                    categoryElement.className = 'category';
                    categoryElement.setAttribute('data-category', categoryName);
                    categoryElement.innerHTML = `
                        <h4>${categoryName}</h4>
                        <p>${imageUrls.length} images</p>
                    `;
                    
                    categoryElement.addEventListener('click', function() {
                        // Remove selected class from all categories
                        document.querySelectorAll('.category').forEach(c => c.classList.remove('selected'));
                        // Add selected class to clicked category
                        this.classList.add('selected');
                        // Set the selected category
                        selectedCategory = categoryName;
                        selectedCategoryElement.textContent = selectedCategory;
                        
                        // Enable start button
                        startBtn.disabled = false;
                    });
                    
                    categoriesContainer.appendChild(categoryElement);
                }
                
                // Auto-select the first category if available
                if (Object.keys(cats).length > 0) {
                    const firstCategory = Object.keys(cats)[0];
                    setTimeout(() => {
                        document.querySelector(`.category[data-category="${firstCategory}"]`).click();
                    }, 100);
                }
            }
            
            // Show status message
            function showStatus(message, type) {
                statusMessage.textContent = message;
                statusMessage.className = `status ${type}`;
                statusMessage.style.display = 'block';
                
                // Auto-hide success messages after 5 seconds
                if (type === 'success') {
                    setTimeout(() => {
                        statusMessage.style.display = 'none';
                    }, 5000);
                }
            }
            
            // Function to start the game
            function startGame() {
                if (!selectedCategory || !categories[selectedCategory]) {
                    showStatus('Please select a category to start the game.', 'error');
                    return;
                }
                
                // Get images for selected category
                availableImages = categories[selectedCategory];
                
                if (availableImages.length < 2) {
                    showStatus('Selected category has less than 2 images. Please add more images to this category.', 'error');
                    return;
                }
                
                // Save player names
                localStorage.setItem('player1Name', player1NameElement.value);
                localStorage.setItem('player2Name', player2NameElement.value);
                
                gameActive = true;
                gamePaused = false;
                player1Time = parseFloat(initialTimeInput.value);
                player2Time = parseFloat(initialTimeInput.value);
                player1Score = 0;
                player2Score = 0;
                currentPlayer = 1;
                usedImages = [];
                
                player1ScoreElement.textContent = "0";
                player2ScoreElement.textContent = "0";
                player1TimeElement.textContent = `Time: ${player1Time.toFixed(1)}s`;
                player2TimeElement.textContent = `Time: ${player2Time.toFixed(1)}s`;
                
                player1Element.classList.add('active');
                player2Element.classList.remove('active');
                
                correctBtn.disabled = false;
                passBtn.disabled = false;
                pauseBtn.disabled = false;
                pauseBtn.textContent = "Pause";
                pauseBtn.classList.remove("paused");
                startBtn.disabled = true;
                initialTimeInput.disabled = true;
                passPenaltyInput.disabled = true;
                player1NameElement.disabled = true;
                player2NameElement.disabled = true;
                gameOverElement.style.display = 'none';
                
                // Disable category selection during game
                document.querySelectorAll('.category').forEach(category => {
                    category.style.pointerEvents = 'none';
                });
                
                // Clear any answer display
                answerDisplayElement.textContent = "";
                answerDisplayElement.className = "answer-display";
                
                // Start with a random image
                nextImage();
                
                // Start the timer for the first player
                lastTimerUpdate = Date.now();
                startTimer();
            }
            
            // Function to handle next image
            function nextImage() {
                // Filter out used images
                const unusedImages = availableImages.filter((img, index) => !usedImages.includes(index));
                
                if (unusedImages.length === 0) {
                    endGame("All images have been used!");
                    return;
                }
                
                const randomIndex = Math.floor(Math.random() * unusedImages.length);
                const selectedImageIndex = availableImages.indexOf(unusedImages[randomIndex]);
                currentImage = availableImages[selectedImageIndex];
                usedImages.push(selectedImageIndex);
                
                currentImageElement.src = currentImage.url;
            }
            
            // Function to start the timer for the current player
            function startTimer() {
                if (timerInterval) {
                    clearInterval(timerInterval);
                }
                
                timerInterval = setInterval(() => {
                    if (!gameActive || gamePaused) return;
                    
                    const now = Date.now();
                    const delta = (now - lastTimerUpdate) / 1000; // Convert to seconds
                    lastTimerUpdate = now;
                    
                    if (currentPlayer === 1) {
                        player1Time -= delta;
                        player1TimeElement.textContent = `Time: ${Math.max(0, player1Time).toFixed(1)}s`;
                        
                        if (player1Time <= 0) {
                            endGame(`${player1NameElement.value} ran out of time!`);
                        }
                    } else {
                        player2Time -= delta;
                        player2TimeElement.textContent = `Time: ${Math.max(0, player2Time).toFixed(1)}s`;
                        
                        if (player2Time <= 0) {
                            endGame(`${player2NameElement.value} ran out of time!`);
                        }
                    }
                }, 100);
            }
            
            // Function to stop the timer
            function stopTimer() {
                if (timerInterval) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                }
            }
            
            // Function to toggle pause state
            function togglePause() {
                if (!gameActive) return;
                
                gamePaused = !gamePaused;
                
                if (gamePaused) {
                    stopTimer();
                    pauseBtn.textContent = "Resume";
                    pauseBtn.classList.add("paused");
                    correctBtn.disabled = true;
                    passBtn.disabled = true;
                } else {
                    lastTimerUpdate = Date.now();
                    startTimer();
                    pauseBtn.textContent = "Pause";
                    pauseBtn.classList.remove("paused");
                    correctBtn.disabled = false;
                    passBtn.disabled = false;
                }
            }
            
            // Function to display answer
            function displayAnswer(isCorrect) {
                // Stop the timer while showing the answer
                stopTimer();
                
                answerDisplayElement.textContent = `Correct answer: ${currentImage.name}`;
                answerDisplayElement.className = isCorrect ? 
                    "answer-display correct-answer" : "answer-display pass-answer";
                
                // Clear any existing timeout
                if (answerTimeout) {
                    clearTimeout(answerTimeout);
                }
                
                // Disable buttons temporarily
                correctBtn.disabled = true;
                passBtn.disabled = true;
                pauseBtn.disabled = true;
                
                // Set timeout to continue game after showing answer
                answerTimeout = setTimeout(() => {
                    answerDisplayElement.textContent = "";
                    answerDisplayElement.className = "answer-display";
                    
                    // Check if all images have been used
                    const unusedImages = availableImages.filter((img, index) => !usedImages.includes(index));
                    if (unusedImages.length === 0) {
                        endGame("All images have been used!");
                        return;
                    }
                    
                    // Update last timer update time before restarting
                    lastTimerUpdate = Date.now();
                    
                    if (isCorrect) {
                        // After correct answer, switch player and show next image
                        switchPlayer();
                        nextImage();
                    } else {
                        // After pass, just show next image for same player
                        nextImage();
                    }
                    
                    // Re-enable buttons and restart timer
                    correctBtn.disabled = false;
                    passBtn.disabled = false;
                    pauseBtn.disabled = false;
                    startTimer();
                }, 2000);
            }
            
            // Function to switch player
            function switchPlayer() {
                currentPlayer = currentPlayer === 1 ? 2 : 1;
                
                if (currentPlayer === 1) {
                    player1Element.classList.add('active');
                    player2Element.classList.remove('active');
                } else {
                    player1Element.classList.remove('active');
                    player2Element.classList.add('active');
                }
                
                // Update timer display when switching players
                player1TimeElement.textContent = `Time: ${player1Time.toFixed(1)}s`;
                player2TimeElement.textContent = `Time: ${player2Time.toFixed(1)}s`;
            }
            
            // Function to handle correct answer
            function handleCorrect() {
                if (!gameActive || gamePaused) return;
                
                if (currentPlayer === 1) {
                    player1Score++;
                    player1ScoreElement.textContent = player1Score;
                } else {
                    player2Score++;
                    player2ScoreElement.textContent = player2Score;
                }
                
                // Display answer in green
                displayAnswer(true);
            }
            
            // Function to handle pass
            function handlePass() {
                if (!gameActive || gamePaused) return;
                
                // Apply time penalty
                const penalty = parseFloat(passPenaltyInput.value);
                if (currentPlayer === 1) {
                    player1Time -= penalty;
                    player1TimeElement.textContent = `Time: ${player1Time.toFixed(1)}s`;
                    if (player1Time <= 0) {
                        endGame(`${player1NameElement.value} ran out of time!`);
                        return;
                    }
                } else {
                    player2Time -= penalty;
                    player2TimeElement.textContent = `Time: ${player2Time.toFixed(1)}s`;
                    if (player2Time <= 0) {
                        endGame(`${player2NameElement.value} ran out of time!`);
                        return;
                    }
                }
                
                // Display answer in red
                displayAnswer(false);
            }
            
            // Function to end the game
            function endGame(reason = "") {
                gameActive = false;
                gamePaused = false;
                stopTimer();
                if (answerTimeout) {
                    clearTimeout(answerTimeout);
                }
                
                correctBtn.disabled = true;
                passBtn.disabled = true;
                pauseBtn.disabled = true;
                startBtn.disabled = false;
                initialTimeInput.disabled = false;
                passPenaltyInput.disabled = false;
                player1NameElement.disabled = false;
                player2NameElement.disabled = false;
                
                // Re-enable category selection
                document.querySelectorAll('.category').forEach(category => {
                    category.style.pointerEvents = 'auto';
                });
                
                // Determine winner
                let winnerMessage = "";
                if (player1Score > player2Score) {
                    winnerMessage = `${player1NameElement.value} wins!`;
                } else if (player2Score > player1Score) {
                    winnerMessage = `${player2NameElement.value} wins!`;
                } else if (player1Time > player2Time) {
                    winnerMessage = `${player1NameElement.value} wins (tie but more time left)!`;
                } else if (player2Time > player1Time) {
                    winnerMessage = `${player2NameElement.value} wins (tie but more time left)!`;
                } else {
                    winnerMessage = "It's a tie!";
                }
                
                if (reason) {
                    winnerMessage = `${reason} ${winnerMessage}`;
                }
                
                winnerMessageElement.textContent = `${winnerMessage} Final Score: ${player1NameElement.value}: ${player1Score} - ${player2NameElement.value}: ${player2Score}`;
                gameOverElement.style.display = 'block';
                
                // Scroll to game over message
                gameOverElement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
            
            // Initialize the game
            initGame();
            
            // Event listeners
            startBtn.addEventListener('click', startGame);
            restartBtn.addEventListener('click', startGame);
            correctBtn.addEventListener('click', handleCorrect);
            passBtn.addEventListener('click', handlePass);
            pauseBtn.addEventListener('click', togglePause);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (!gameActive) return;
                if (correctBtn.disabled) return; // Prevent keyboard input when buttons are disabled
                
                if (e.key === 'ArrowLeft') {
                    handleCorrect();
                    // Visual feedback
                    correctBtn.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        correctBtn.style.transform = '';
                    }, 100);
                } else if (e.key === 'ArrowRight') {
                    handlePass();
                    // Visual feedback
                    passBtn.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        passBtn.style.transform = '';
                    }, 100);
                } else if (e.key === 'p' || e.key === 'P') {
                    togglePause();
                    // Visual feedback
                    pauseBtn.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        pauseBtn.style.transform = '';
                    }, 100);
                }
            });
        });
    </script>
</body>
</html>
